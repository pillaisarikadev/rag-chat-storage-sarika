# RAG Chat Storage Microservice

A production-ready template microservice for storing chat sessions & messages generated by a RAG chatbot.

## Tech
- Java 17, Spring Boot 3.3
- PostgreSQL + JPA
- API Key auth (`X-API-Key`)
- Rate limiting (Bucket4j)
- CORS, centralized error handling, logging
- OpenAPI/Swagger (springdoc)
- Dockerized (app + Postgres + pgAdmin)
- Health check `/health`

## Quick Start

```bash
cp .env.example .env   # edit values if you want
docker compose up --build
```

Visit:
- API: http://localhost:8080/swagger-ui/index.html
- Health: http://localhost:8080/health
- pgAdmin: http://localhost:5050

> For local (non-docker) run: `mvn spring-boot:run` (ensure Postgres is running).

## API (v1)

All endpoints (except `/health` and swagger docs) require header `X-API-Key: <your key>`.

### Sessions
- `POST /api/v1/sessions` – create new session `{ "title": "My chat", "userId": "u1" }`
- `GET /api/v1/sessions?userId=u1&favorite=true&page=0&size=20`
- `PATCH /api/v1/sessions/{id}/rename` – `{ "title": "New name" }`
- `PATCH /api/v1/sessions/{id}/favorite` – `{ "favorite": true }`
- `DELETE /api/v1/sessions/{id}` – deletes session and its messages

### Messages
- `POST /api/v1/sessions/{id}/messages` – `{ "sender":"user","content":"hi","context":{"docId":"123"}}`
- `GET /api/v1/sessions/{id}/messages?page=0&size=50`

## Environment Variables
See `.env.example` for all supported variables.

## Testing
Basic unit test exists under `src/test/...` – run with
```bash
mvn test
```

## Notes
- Spring Boot 3 requires Java 17+. If you must use Java 11/8, downgrade to Boot 2.x and adjust `pom.xml`.
